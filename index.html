<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hiragana & Katakana Quiz</title>

<style>
body {
  font-family: Arial;
  text-align: center;
  background-color: #f5f5f5;
  padding: 20px;
}
input {
  font-size: 18px;
  padding: 8px;
  width: 90%;
  max-width: 300px;
}
button {
  font-size: 18px;
  padding: 8px 15px;
  margin: 5px;
  background: #4792d9;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
#feedback { font-size: 20px; height: 30px; margin-top: 10px; }
#stats { margin-top: 10px; font-size: 18px; }

#progressContainer {
  width: 90%;
  max-width: 300px;
  height: 15px;
  background: #ddd;
  border-radius: 10px;
  margin: 15px auto;
  display: none;
}
#progressBar {
  height: 100%;
  width: 0%;
  background: #4caf50;
  border-radius: 10px;
}
</style>
</head>

<body>

<h1>Hiragana & Katakana Quiz</h1>

<p id="hiragana" style="font-size:60px;"></p>

<div id="progressContainer">
  <div id="progressBar"></div>
</div>

<p id="feedback"></p>
<input type="text" id="answer" placeholder="Escribe romaji">

<div style="margin-top:10px">
  <label><input type="checkbox" id="simpleH" checked> Hiragana simples</label><br>
  <label><input type="checkbox" id="complexH"> Hiragana complejos</label><br>
  <label><input type="checkbox" id="katakanaChk"> Katakana</label>
</div>

<button onclick="checkAnswer()">Enviar</button>
<button onclick="resetQuiz()">Empezar de nuevo</button>
<button onclick="startTest()">Modo test</button>

<p id="stats">Aciertos: 0 | Errores: 0</p>

<script>
// ------------------ DATOS ------------------

const hiraganaSimple = {
      'ã‚':'a','ã„':'i','ã†':'u','ãˆ':'e','ãŠ':'o',
      'ã‹':'ka','ã':'ki','ã':'ku','ã‘':'ke','ã“':'ko',
      'ãŒ':'ga','ãŽ':'gi','ã':'gu','ã’':'ge','ã”':'go',
      'ã•':'sa','ã—':'shi','ã™':'su','ã›':'se','ã':'so',
      'ã–':'za','ã˜':'ji','ãš':'zu','ãœ':'ze','ãž':'zo',
      'ãŸ':'ta','ã¡':'chi','ã¤':'tsu','ã¦':'te','ã¨':'to',
      'ã ':'da','ã§':'de','ã©':'do',
      'ãª':'na','ã«':'ni','ã¬':'nu','ã­':'ne','ã®':'no',
      'ã¯':'ha','ã²':'hi','ãµ':'fu','ã¸':'he','ã»':'ho',
      'ã°':'ba','ã³':'bi','ã¶':'bu','ã¹':'be','ã¼':'bo',
      'ã±':'pa','ã´':'pi','ã·':'pu','ãº':'pe','ã½':'po',
      'ã¾':'ma','ã¿':'mi','ã‚€':'mu','ã‚':'me','ã‚‚':'mo',
      'ã‚„':'ya','ã‚†':'yu','ã‚ˆ':'yo',
      'ã‚‰':'ra','ã‚Š':'ri','ã‚‹':'ru','ã‚Œ':'re','ã‚':'ro',
      'ã‚':'wa','ã‚’':'wo','ã‚“':'n'
    };

    const hiraganaComplex = {
      'ãã‚ƒ':'kya','ãã‚…':'kyu','ãã‚‡':'kyo',
      'ãŽã‚ƒ':'gya','ãŽã‚…':'gyu','ãŽã‚‡':'gyo',
      'ã—ã‚ƒ':'sha','ã—ã‚…':'shu','ã—ã‚‡':'sho',
      'ã˜ã‚ƒ':'ja','ã˜ã‚…':'ju','ã˜ã‚‡':'jo',
      'ã¡ã‚ƒ':'cha','ã¡ã‚…':'chu','ã¡ã‚‡':'cho',
      'ã«ã‚ƒ':'nya','ã«ã‚…':'nyu','ã«ã‚‡':'nyo',
      'ã²ã‚ƒ':'hya','ã²ã‚…':'hyu','ã²ã‚‡':'hyo',
      'ã³ã‚ƒ':'bya','ã³ã‚…':'byu','ã³ã‚‡':'byo',
      'ã´ã‚ƒ':'pya','ã´ã‚…':'pyu','ã´ã‚‡':'pyo',
      'ã¿ã‚ƒ':'mya','ã¿ã‚…':'myu','ã¿ã‚‡':'myo',
      'ã‚Šã‚ƒ':'rya','ã‚Šã‚…':'ryu','ã‚Šã‚‡':'ryo'
    };

    const katakanaChars = {
      'ã‚¢':'a','ã‚¤':'i','ã‚¦':'u','ã‚¨':'e','ã‚ª':'o',
      'ã‚«':'ka','ã‚­':'ki','ã‚¯':'ku','ã‚±':'ke','ã‚³':'ko',
      'ã‚¬':'ga','ã‚®':'gi','ã‚°':'gu','ã‚²':'ge','ã‚´':'go',
      'ã‚µ':'sa','ã‚·':'shi','ã‚¹':'su','ã‚»':'se','ã‚½':'so',
      'ã‚¶':'za','ã‚¸':'ji','ã‚º':'zu','ã‚¼':'ze','ã‚¾':'zo',
      'ã‚¿':'ta','ãƒ':'chi','ãƒ„':'tsu','ãƒ†':'te','ãƒˆ':'to',
      'ãƒ€':'da','ãƒ‡':'de','ãƒ‰':'do',
      'ãƒŠ':'na','ãƒ‹':'ni','ãƒŒ':'nu','ãƒ':'ne','ãƒŽ':'no',
      'ãƒ':'ha','ãƒ’':'hi','ãƒ•':'fu','ãƒ˜':'he','ãƒ›':'ho',
      'ãƒ':'ba','ãƒ“':'bi','ãƒ–':'bu','ãƒ™':'be','ãƒœ':'bo',
      'ãƒ‘':'pa','ãƒ”':'pi','ãƒ—':'pu','ãƒš':'pe','ãƒ':'po',
      'ãƒž':'ma','ãƒŸ':'mi','ãƒ ':'mu','ãƒ¡':'me','ãƒ¢':'mo',
      'ãƒ¤':'ya','ãƒ¦':'yu','ãƒ¨':'yo',
      'ãƒ©':'ra','ãƒª':'ri','ãƒ«':'ru','ãƒ¬':'re','ãƒ­':'ro',
      'ãƒ¯':'wa','ãƒ²':'wo','ãƒ³':'n'
    };

// ------------------ ESTADO ------------------

let pool = {};
let currentChar = '';
let correct = 0;
let wrong = 0;

let testMode = false;
let testList = [];
let testIndex = 0;
let failedChars = [];

// ------------------ FUNCIONES ------------------

function updatePool() {
  pool = {};
  if (simpleH.checked) Object.assign(pool, hiraganaSimple);
  if (complexH.checked) Object.assign(pool, hiraganaComplex);
  if (katakanaChk.checked) Object.assign(pool, katakanaChars);
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function showChar() {
  hiragana.innerText = currentChar;
  answer.value = '';
  feedback.innerText = '';
  updateProgress();
}

function randomChar() {
  if (testMode) return;
  updatePool();
  const keys = Object.keys(pool);
  if (!keys.length) return;
  currentChar = keys[Math.floor(Math.random() * keys.length)];
  showChar();
}

function startTest() {
  updatePool();
  testList = Object.keys(pool);
  if (!testList.length) {
    alert("Selecciona al menos una opciÃ³n");
    return;
  }

  shuffle(testList);
  testIndex = 0;
  correct = 0;
  wrong = 0;
  failedChars = [];
  testMode = true;

  simpleH.disabled = complexH.disabled = katakanaChk.disabled = true;
  progressContainer.style.display = "block";
  progressBar.style.width = "0%";

  currentChar = testList[0];
  updateStats();
  showChar();
}

function checkAnswer() {
  const ans = answer.value.trim().toLowerCase();
  if (!ans) return;

  if (ans === pool[currentChar]) {
    feedback.innerText = "âœ… Correcto";
    correct++;
  } else {
    feedback.innerText = `âŒ ${pool[currentChar]}`;
    wrong++;
    failedChars.push(`${currentChar} â†’ ${pool[currentChar]}`);
  }

  updateStats();

  if (testMode) {
    testIndex++;
    if (testIndex >= testList.length) {
      finishTest();
    } else {
      currentChar = testList[testIndex];
      setTimeout(showChar, 600);
    }
  } else {
    setTimeout(randomChar, 600);
  }
}

function updateProgress() {
  if (!testMode) return;
  progressBar.style.width =
    ((testIndex + 1) / testList.length) * 100 + "%";
}

function finishTest() {
  const nota = ((correct / testList.length) * 10).toFixed(2);

  let mensaje = `Nota final: ${nota}/10\n\n`;
  if (failedChars.length) {
    mensaje += "Fallos:\n" + failedChars.join("\n");
  } else {
    mensaje += "Â¡Perfecto! Sin fallos ðŸŽ‰";
  }

  alert(mensaje);

  testMode = false;
  progressContainer.style.display = "none";
  simpleH.disabled = complexH.disabled = katakanaChk.disabled = false;
  randomChar();
}

function updateStats() {
  stats.innerText = `Aciertos: ${correct} | Errores: ${wrong}`;
}

function resetQuiz() {
  testMode = false;
  correct = 0;
  wrong = 0;
  progressContainer.style.display = "none";
  simpleH.disabled = complexH.disabled = katakanaChk.disabled = false;
  updateStats();
  randomChar();
}

answer.addEventListener("keydown", e => {
  if (e.key === "Enter") checkAnswer();
});

// Inicio
randomChar();
</script>

</body>
</html>
