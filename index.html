<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hiragana Quiz</title>
  <style>
    /* Make the app occupy full viewport on mobile and desktop */
    html, body { height: 100%; margin: 0; }
    body {
      font-family: Arial;
      text-align: center;
      background-color: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
      /* Use CSS variable set by JS for mobile browser chrome issues */
      min-height: 100vh;
      min-height: calc(var(--vh, 1vh) * 100);
      flex-direction: column;
    }
    input { font-size: 18px; padding: 8px; border: 2px solid #ccc; border-radius: 5px; width: 90%; max-width: 300px; }
    button { font-size: 18px; padding: 8px 15px; margin: 5px; border: none; border-radius: 5px; background-color: #4792d9; color: white; cursor: pointer; }
    button:hover { background-color: #3b7fb8; }
    #feedback { margin-top: 20px; font-weight: bold; font-size: 20px; height: 30px; }
    #stats { margin-top: 20px; font-size: 18px; color: #333; }
  </style>
</head>
<body>
  <h1>Hiragana Quiz</h1>
  <p id="hiragana" style="font-size: 60px;"></p>
  <input type="text" id="answer" placeholder="Escribe romaji">
  <div style="margin-top:10px;">
    <label style="font-size:14px; margin-right:8px">
      <input type="checkbox" id="simpleOnly"> Mostrar solo hiraganas simples
    </label>
  </div>
  <button onclick="checkAnswer()">Enviar</button>
  <button onclick="resetQuiz()">Empezar de nuevo</button>
  <p id="feedback"></p>
  <p id="stats">Aciertos: 0 | Errores: 0</p>

  <script>
    // Diccionario completo de hiragana + combinaciones
    const hiraganaMap = {
      // Vocales
  'あ':'a','い':'i','う':'u','え':'e','お':'o',

  // K
  'か':'ka','き':'ki','く':'ku','け':'ke','こ':'ko',
  'きゃ':'kya','きゅ':'kyu','きょ':'kyo',

  // G
  'が':'ga','ぎ':'gi','ぐ':'gu','げ':'ge','ご':'go',
  'ぎゃ':'gya','ぎゅ':'gyu','ぎょ':'gyo',

  // S
  'さ':'sa','し':'shi','す':'su','せ':'se','そ':'so',
  'しゃ':'sha','しゅ':'shu','しょ':'sho',

  // Z
  'ざ':'za','じ':'ji','ず':'zu','ぜ':'ze','ぞ':'zo',
  'じゃ':'ja','じゅ':'ju','じょ':'jo',

  // T
  'た':'ta','ち':'ti','つ':'tsu','て':'te','と':'to',
  'ちゃ':'cha','ちゅ':'chu','ちょ':'cho',

  // D
  'だ':'da','ぢ':'ji','づ':'zu','で':'de','ど':'do',
  'ぢゃ':'ja','ぢゅ':'ju','ぢょ':'jo',

  // N
  'な':'na','に':'ni','ぬ':'nu','ね':'ne','の':'no',
  'にゃ':'nya','にゅ':'nyu','にょ':'nyo',

  // H
  'は':'ha','ひ':'hi','ふ':'hu','へ':'he','ほ':'ho',
  'ひゃ':'hya','ひゅ':'hyu','ひょ':'hyo',

  // B
  'ば':'ba','び':'bi','ぶ':'bu','べ':'be','ぼ':'bo',
  'びゃ':'bya','びゅ':'byu','びょ':'byo',

  // P
  'ぱ':'pa','ぴ':'pi','ぷ':'pu','ぺ':'pe','ぽ':'po',
  'ぴゃ':'pya','ぴゅ':'pyu','ぴょ':'pyo',

  // M
  'ま':'ma','み':'mi','む':'mu','め':'me','も':'mo',
  'みゃ':'mya','みゅ':'myu','みょ':'myo',

  // Y
  'や':'ya','ゆ':'yu','よ':'yo',

  // R
  'ら':'ra','り':'ri','る':'ru','れ':'re','ろ':'ro',
  'りゃ':'rya','りゅ':'ryu','りょ':'ryo',

  // W
  'わ':'wa','を':'wo',

  // N
  'ん':'n',

    };

    const soundCorrect = new Audio('audio/correct.mp3');
    const soundWrong = new Audio('audio/wrong.mp3');


    const allHiraganaKeys = Object.keys(hiraganaMap);
    // simple = single-character keys (no combinations like きゃ, ぎゅ, etc.)
    const simpleHiraganaKeys = allHiraganaKeys.filter(k => k.length === 1);
    let currentChar = '';
    let correct = 0;
    let wrong = 0;

    function getActiveKeys() {
      const simpleOnly = document.getElementById('simpleOnly');
      return (simpleOnly && simpleOnly.checked) ? simpleHiraganaKeys : allHiraganaKeys;
    }

    function randomHiragana() {
      const keys = getActiveKeys();
      const idx = Math.floor(Math.random() * keys.length);
      currentChar = keys[idx];
      document.getElementById('hiragana').innerText = currentChar;
      document.getElementById('answer').value = '';
      document.getElementById('feedback').innerText = '';
    }

    // If the user toggles the switch, immediately pick a new character
    const simpleCheckbox = document.getElementById('simpleOnly');
    if (simpleCheckbox) {
      simpleCheckbox.addEventListener('change', function() {
        randomHiragana();
      });
    }

    function checkAnswer() {
      const userAnswer = document.getElementById('answer').value.toLowerCase().trim();
      if(!userAnswer) {
        document.getElementById('feedback').innerText = '⚠️ Por favor, escribe algo';
        return;
      }
      if(userAnswer === hiraganaMap[currentChar]) {
        document.getElementById('feedback').innerText = '✅ Correcto!';
        correct++;
        try { soundCorrect.play(); } catch(e) { console.log('Audio no disponible'); }
      } else {
        document.getElementById('feedback').innerText = `❌ Incorrecto. Es "${hiraganaMap[currentChar]}"`;
        wrong++;
        try { soundWrong.play(); } catch(e) { console.log('Audio no disponible'); }
      }
      updateStats();
      setTimeout(randomHiragana, 1000);
    }
    // Detecta la tecla Enter en el input
    document.getElementById('answer').addEventListener('keydown', function(event) {
    if(event.key === 'Enter') {   // Si se pulsa Enter
      checkAnswer();
    }
});

    function updateStats() {
      document.getElementById('stats').innerText = `Aciertos: ${correct} | Errores: ${wrong}`;
    }

    function resetQuiz() {
      correct = 0;
      wrong = 0;
      updateStats();
      randomHiragana();
    }

    // Ajuste para altura real del viewport en móviles: define --vh
    function setVh() {
      document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px');
    }
    setVh();
    window.addEventListener('resize', setVh);

    // Inicializa el quiz
    randomHiragana();
  </script>
</body>
</html>

